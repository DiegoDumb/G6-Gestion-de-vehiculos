-- TRIGGERS E INSERTS

-- creo el trigger para rellenar Historial a la vez que Vehiculos

drop trigger if exists RellenarHistorial;
create trigger RellenarHistorial
AFTER INSERT ON Vehiculos for each row
insert into Historial(Matricula, Fecha_compra, num_Bastidor, color, num_Asientos, precio, serie, Tipo_vehiculo)
values (new.Matricula, new.Fecha_compra, new.num_Bastidor, new.color, new.num_Asientos, new.precio, new.serie, new.Tipo_vehiculo);

INSERT INTO Vehiculos VALUES("234 FDA",'2020-06-03',"V23P52E93","rojo",2,380000,"LAMB0001","Coche");

INSERT INTO Coches VALUES("234 FDA","2","240");
INSERT INTO Series VALUES("LAMB0001","Lamborghini","Aventador","2014");

-- creo el siguiente trigger para actualizar el color cuando se actualice en vehiculos.

DROP TRIGGER IF EXISTS ActualizarHistorial;
CREATE TRIGGER ActualizarHistorial
AFTER UPDATE ON Vehiculos for each row
UPDATE historial SET color = new.color;

UPDATE Vehiculos SET color = "morado" WHERE Matricula = "234 FDA";

-- creo el siguiente trigger para a√±adir la fecha de la venta al historial

DROP TRIGGER IF EXISTS ActualizarVentaHistorial;
CREATE TRIGGER ActualizarVentaHistorial
AFTER INSERT ON Ventas for each row
UPDATE historial SET Fecha_venta = new.Fecha_venta;

INSERT INTO Ventas VALUES("73033899K","2020-12-03","234 FDA", "Ekaitz", "666888999", "esotoap19dw31@gmail.com");
